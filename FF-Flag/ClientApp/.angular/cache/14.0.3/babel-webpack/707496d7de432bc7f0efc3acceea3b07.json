{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nimport { getRandomIntegerInclusive } from \"@azure/core-util\";\nimport { isThrottlingRetryResponse } from \"./throttlingRetryStrategy\"; // intervals are in milliseconds\n\nconst DEFAULT_CLIENT_RETRY_INTERVAL = 1000;\nconst DEFAULT_CLIENT_MAX_RETRY_INTERVAL = 1000 * 64;\n/**\n * A retry strategy that retries with an exponentially increasing delay in these two cases:\n * - When there are errors in the underlying transport layer (e.g. DNS lookup failures).\n * - Or otherwise if the outgoing request fails (408, greater or equal than 500, except for 501 and 505).\n */\n\nexport function exponentialRetryStrategy(options = {}) {\n  var _a, _b;\n\n  const retryInterval = (_a = options.retryDelayInMs) !== null && _a !== void 0 ? _a : DEFAULT_CLIENT_RETRY_INTERVAL;\n  const maxRetryInterval = (_b = options.maxRetryDelayInMs) !== null && _b !== void 0 ? _b : DEFAULT_CLIENT_MAX_RETRY_INTERVAL;\n  let retryAfterInMs = retryInterval;\n  return {\n    name: \"exponentialRetryStrategy\",\n\n    retry({\n      retryCount,\n      response,\n      responseError\n    }) {\n      const matchedSystemError = isSystemError(responseError);\n      const ignoreSystemErrors = matchedSystemError && options.ignoreSystemErrors;\n      const isExponential = isExponentialRetryResponse(response);\n      const ignoreExponentialResponse = isExponential && options.ignoreHttpStatusCodes;\n      const unknownResponse = response && (isThrottlingRetryResponse(response) || !isExponential);\n\n      if (unknownResponse || ignoreExponentialResponse || ignoreSystemErrors) {\n        return {\n          skipStrategy: true\n        };\n      }\n\n      if (responseError && !matchedSystemError && !isExponential) {\n        return {\n          errorToThrow: responseError\n        };\n      } // Exponentially increase the delay each time\n\n\n      const exponentialDelay = retryAfterInMs * Math.pow(2, retryCount); // Don't let the delay exceed the maximum\n\n      const clampedExponentialDelay = Math.min(maxRetryInterval, exponentialDelay); // Allow the final value to have some \"jitter\" (within 50% of the delay size) so\n      // that retries across multiple clients don't occur simultaneously.\n\n      retryAfterInMs = clampedExponentialDelay / 2 + getRandomIntegerInclusive(0, clampedExponentialDelay / 2);\n      return {\n        retryAfterInMs\n      };\n    }\n\n  };\n}\n/**\n * A response is a retry response if it has status codes:\n * - 408, or\n * - Greater or equal than 500, except for 501 and 505.\n */\n\nexport function isExponentialRetryResponse(response) {\n  return Boolean(response && response.status !== undefined && (response.status >= 500 || response.status === 408) && response.status !== 501 && response.status !== 505);\n}\n/**\n * Determines whether an error from a pipeline response was triggered in the network layer.\n */\n\nexport function isSystemError(err) {\n  if (!err) {\n    return false;\n  }\n\n  return err.code === \"ETIMEDOUT\" || err.code === \"ESOCKETTIMEDOUT\" || err.code === \"ECONNREFUSED\" || err.code === \"ECONNRESET\" || err.code === \"ENOENT\";\n}","map":{"version":3,"names":["getRandomIntegerInclusive","isThrottlingRetryResponse","DEFAULT_CLIENT_RETRY_INTERVAL","DEFAULT_CLIENT_MAX_RETRY_INTERVAL","exponentialRetryStrategy","options","_a","_b","retryInterval","retryDelayInMs","maxRetryInterval","maxRetryDelayInMs","retryAfterInMs","name","retry","retryCount","response","responseError","matchedSystemError","isSystemError","ignoreSystemErrors","isExponential","isExponentialRetryResponse","ignoreExponentialResponse","ignoreHttpStatusCodes","unknownResponse","skipStrategy","errorToThrow","exponentialDelay","Math","pow","clampedExponentialDelay","min","Boolean","status","undefined","err","code"],"sources":["C:/Users/prash/source/repos/FF-Flag/FF-Flag/ClientApp/node_modules/@azure/core-rest-pipeline/dist-esm/src/retryStrategies/exponentialRetryStrategy.js"],"sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nimport { getRandomIntegerInclusive } from \"@azure/core-util\";\nimport { isThrottlingRetryResponse } from \"./throttlingRetryStrategy\";\n// intervals are in milliseconds\nconst DEFAULT_CLIENT_RETRY_INTERVAL = 1000;\nconst DEFAULT_CLIENT_MAX_RETRY_INTERVAL = 1000 * 64;\n/**\n * A retry strategy that retries with an exponentially increasing delay in these two cases:\n * - When there are errors in the underlying transport layer (e.g. DNS lookup failures).\n * - Or otherwise if the outgoing request fails (408, greater or equal than 500, except for 501 and 505).\n */\nexport function exponentialRetryStrategy(options = {}) {\n    var _a, _b;\n    const retryInterval = (_a = options.retryDelayInMs) !== null && _a !== void 0 ? _a : DEFAULT_CLIENT_RETRY_INTERVAL;\n    const maxRetryInterval = (_b = options.maxRetryDelayInMs) !== null && _b !== void 0 ? _b : DEFAULT_CLIENT_MAX_RETRY_INTERVAL;\n    let retryAfterInMs = retryInterval;\n    return {\n        name: \"exponentialRetryStrategy\",\n        retry({ retryCount, response, responseError }) {\n            const matchedSystemError = isSystemError(responseError);\n            const ignoreSystemErrors = matchedSystemError && options.ignoreSystemErrors;\n            const isExponential = isExponentialRetryResponse(response);\n            const ignoreExponentialResponse = isExponential && options.ignoreHttpStatusCodes;\n            const unknownResponse = response && (isThrottlingRetryResponse(response) || !isExponential);\n            if (unknownResponse || ignoreExponentialResponse || ignoreSystemErrors) {\n                return { skipStrategy: true };\n            }\n            if (responseError && !matchedSystemError && !isExponential) {\n                return { errorToThrow: responseError };\n            }\n            // Exponentially increase the delay each time\n            const exponentialDelay = retryAfterInMs * Math.pow(2, retryCount);\n            // Don't let the delay exceed the maximum\n            const clampedExponentialDelay = Math.min(maxRetryInterval, exponentialDelay);\n            // Allow the final value to have some \"jitter\" (within 50% of the delay size) so\n            // that retries across multiple clients don't occur simultaneously.\n            retryAfterInMs =\n                clampedExponentialDelay / 2 + getRandomIntegerInclusive(0, clampedExponentialDelay / 2);\n            return { retryAfterInMs };\n        },\n    };\n}\n/**\n * A response is a retry response if it has status codes:\n * - 408, or\n * - Greater or equal than 500, except for 501 and 505.\n */\nexport function isExponentialRetryResponse(response) {\n    return Boolean(response &&\n        response.status !== undefined &&\n        (response.status >= 500 || response.status === 408) &&\n        response.status !== 501 &&\n        response.status !== 505);\n}\n/**\n * Determines whether an error from a pipeline response was triggered in the network layer.\n */\nexport function isSystemError(err) {\n    if (!err) {\n        return false;\n    }\n    return (err.code === \"ETIMEDOUT\" ||\n        err.code === \"ESOCKETTIMEDOUT\" ||\n        err.code === \"ECONNREFUSED\" ||\n        err.code === \"ECONNRESET\" ||\n        err.code === \"ENOENT\");\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}